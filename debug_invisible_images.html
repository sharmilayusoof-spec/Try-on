<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Invisible Images</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .debug-section {
            background: #252526;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        h2 {
            color: #4ec9b0;
            margin-top: 0;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        .success {
            background: #1e3a1e;
            border-left: 4px solid #4ec9b0;
        }
        .error {
            background: #3a1e1e;
            border-left: 4px solid #f48771;
        }
        .warning {
            background: #3a3a1e;
            border-left: 4px solid #dcdcaa;
        }
        .info {
            background: #1e2a3a;
            border-left: 4px solid #569cd6;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1177bb;
        }
        .fix-button {
            background: #16825d;
        }
        .fix-button:hover {
            background: #1a9870;
        }
    </style>
</head>
<body>
    <h1>üîç Debug: Images Loading But Not Visible</h1>
    <p>This diagnostic tool will identify why your images are invisible.</p>
    
    <div class="debug-section">
        <h2>Quick Actions</h2>
        <button onclick="runAllTests()">Run All Diagnostics</button>
        <button onclick="applyQuickFix()" class="fix-button">Apply Quick Fix</button>
        <button onclick="window.location.reload()">Reload Page</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(title, message, type = 'info', code = null) {
            const section = document.createElement('div');
            section.className = 'debug-section';
            
            const heading = document.createElement('h2');
            heading.textContent = title;
            section.appendChild(heading);
            
            const result = document.createElement('div');
            result.className = `result ${type}`;
            result.innerHTML = message;
            section.appendChild(result);
            
            if (code) {
                const pre = document.createElement('pre');
                pre.textContent = code;
                section.appendChild(pre);
            }
            
            results.appendChild(section);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        // Test 1: Check if images exist in DOM
        function testImagesInDOM() {
            const images = document.querySelectorAll('.cloth-image');
            
            if (images.length === 0) {
                addResult(
                    '‚ùå Test 1: Images in DOM',
                    'No images with class "cloth-image" found in DOM!<br>Problem: Images are not being created or inserted.',
                    'error',
                    'Fix: Check your JavaScript renderClothGrid() function'
                );
                return false;
            }
            
            addResult(
                '‚úÖ Test 1: Images in DOM',
                `Found ${images.length} images with class "cloth-image"`,
                'success'
            );
            return true;
        }
        
        // Test 2: Check image load status
        function testImageLoadStatus() {
            const images = document.querySelectorAll('.cloth-image');
            let loaded = 0;
            let failed = 0;
            let pending = 0;
            
            const details = [];
            
            images.forEach((img, i) => {
                const status = {
                    index: i,
                    src: img.src,
                    complete: img.complete,
                    naturalWidth: img.naturalWidth,
                    naturalHeight: img.naturalHeight
                };
                
                if (img.complete && img.naturalWidth > 0) {
                    loaded++;
                    details.push(`‚úì Image ${i}: ${img.naturalWidth}x${img.naturalHeight}`);
                } else if (img.complete && img.naturalWidth === 0) {
                    failed++;
                    details.push(`‚úó Image ${i}: Failed to load`);
                } else {
                    pending++;
                    details.push(`‚è≥ Image ${i}: Still loading`);
                }
            });
            
            if (loaded === images.length) {
                addResult(
                    '‚úÖ Test 2: Image Load Status',
                    `All ${loaded} images loaded successfully (${images[0]?.naturalWidth}x${images[0]?.naturalHeight})`,
                    'success',
                    details.join('\n')
                );
                return true;
            } else {
                addResult(
                    '‚ö†Ô∏è Test 2: Image Load Status',
                    `Loaded: ${loaded}, Failed: ${failed}, Pending: ${pending}`,
                    'warning',
                    details.join('\n')
                );
                return false;
            }
        }
        
        // Test 3: Check computed dimensions
        function testImageDimensions() {
            const images = document.querySelectorAll('.cloth-image');
            const problems = [];
            
            images.forEach((img, i) => {
                const computed = window.getComputedStyle(img);
                const rect = img.getBoundingClientRect();
                
                const info = {
                    index: i,
                    computedWidth: computed.width,
                    computedHeight: computed.height,
                    rectWidth: rect.width,
                    rectHeight: rect.height,
                    display: computed.display,
                    visibility: computed.visibility,
                    opacity: computed.opacity,
                    position: computed.position
                };
                
                // Check for problems
                if (rect.width === 0 || rect.height === 0) {
                    problems.push(`Image ${i}: Zero dimensions (${rect.width}x${rect.height})`);
                }
                if (computed.display === 'none') {
                    problems.push(`Image ${i}: display: none`);
                }
                if (computed.visibility === 'hidden') {
                    problems.push(`Image ${i}: visibility: hidden`);
                }
                if (parseFloat(computed.opacity) === 0) {
                    problems.push(`Image ${i}: opacity: 0`);
                }
            });
            
            if (problems.length > 0) {
                addResult(
                    '‚ùå Test 3: Image Dimensions',
                    `Found ${problems.length} dimension problems!<br>Images are loaded but have zero size or are hidden.`,
                    'error',
                    problems.join('\n')
                );
                return false;
            }
            
            const firstImg = images[0];
            const rect = firstImg.getBoundingClientRect();
            addResult(
                '‚úÖ Test 3: Image Dimensions',
                `Images have proper dimensions: ${rect.width.toFixed(0)}x${rect.height.toFixed(0)}px`,
                'success'
            );
            return true;
        }
        
        // Test 4: Check parent container
        function testParentContainer() {
            const items = document.querySelectorAll('.cloth-item');
            const problems = [];
            
            items.forEach((item, i) => {
                const computed = window.getComputedStyle(item);
                const rect = item.getBoundingClientRect();
                
                if (rect.width === 0 || rect.height === 0) {
                    problems.push(`Item ${i}: Zero size (${rect.width}x${rect.height})`);
                }
                if (computed.display === 'none') {
                    problems.push(`Item ${i}: display: none`);
                }
                if (computed.visibility === 'hidden') {
                    problems.push(`Item ${i}: visibility: hidden`);
                }
                if (parseFloat(computed.opacity) === 0) {
                    problems.push(`Item ${i}: opacity: 0`);
                }
                if (computed.overflow === 'hidden' && rect.height < 50) {
                    problems.push(`Item ${i}: overflow:hidden with small height (${rect.height}px)`);
                }
            });
            
            if (problems.length > 0) {
                addResult(
                    '‚ùå Test 4: Parent Container',
                    `Found ${problems.length} container problems!<br>Parent .cloth-item elements are hiding the images.`,
                    'error',
                    problems.join('\n')
                );
                return false;
            }
            
            addResult(
                '‚úÖ Test 4: Parent Container',
                `All ${items.length} .cloth-item containers are visible`,
                'success'
            );
            return true;
        }
        
        // Test 5: Check CSS conflicts
        function testCSSConflicts() {
            const images = document.querySelectorAll('.cloth-image');
            const conflicts = [];
            
            images.forEach((img, i) => {
                const computed = window.getComputedStyle(img);
                const parent = img.closest('.cloth-item');
                const parentComputed = window.getComputedStyle(parent);
                
                // Check for flex issues
                if (parentComputed.display === 'flex' && computed.flexGrow === '0' && computed.height === 'auto') {
                    conflicts.push(`Image ${i}: In flex container but not growing (add flex: 1)`);
                }
                
                // Check for aspect-ratio issues
                if (parentComputed.aspectRatio !== 'auto' && computed.height === 'auto') {
                    conflicts.push(`Image ${i}: Parent has aspect-ratio but image height is auto`);
                }
                
                // Check z-index
                const zIndex = parseInt(computed.zIndex);
                if (!isNaN(zIndex) && zIndex < 0) {
                    conflicts.push(`Image ${i}: Negative z-index (${zIndex})`);
                }
            });
            
            if (conflicts.length > 0) {
                addResult(
                    '‚ö†Ô∏è Test 5: CSS Conflicts',
                    `Found ${conflicts.length} potential CSS issues`,
                    'warning',
                    conflicts.join('\n')
                );
                return false;
            }
            
            addResult(
                '‚úÖ Test 5: CSS Conflicts',
                'No obvious CSS conflicts detected',
                'success'
            );
            return true;
        }
        
        // Test 6: Check viewport visibility
        function testViewportVisibility() {
            const images = document.querySelectorAll('.cloth-image');
            let inViewport = 0;
            let outViewport = 0;
            
            images.forEach((img) => {
                const rect = img.getBoundingClientRect();
                const isVisible = (
                    rect.top >= 0 &&
                    rect.left >= 0 &&
                    rect.bottom <= window.innerHeight &&
                    rect.right <= window.innerWidth
                );
                
                if (isVisible) {
                    inViewport++;
                } else {
                    outViewport++;
                }
            });
            
            if (inViewport === 0) {
                addResult(
                    '‚ö†Ô∏è Test 6: Viewport Visibility',
                    `All ${images.length} images are outside viewport!<br>Try scrolling to the clothing section.`,
                    'warning'
                );
                return false;
            }
            
            addResult(
                '‚úÖ Test 6: Viewport Visibility',
                `${inViewport} images in viewport, ${outViewport} outside`,
                'success'
            );
            return true;
        }
        
        // Test 7: Check for overlays
        function testOverlays() {
            const images = document.querySelectorAll('.cloth-image');
            const overlays = [];
            
            images.forEach((img, i) => {
                const rect = img.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                const elementAtPoint = document.elementFromPoint(centerX, centerY);
                
                if (elementAtPoint && elementAtPoint !== img && !img.contains(elementAtPoint)) {
                    overlays.push(`Image ${i}: Covered by ${elementAtPoint.tagName}.${elementAtPoint.className}`);
                }
            });
            
            if (overlays.length > 0) {
                addResult(
                    '‚ùå Test 7: Element Overlays',
                    `Found ${overlays.length} images covered by other elements!`,
                    'error',
                    overlays.join('\n')
                );
                return false;
            }
            
            addResult(
                '‚úÖ Test 7: Element Overlays',
                'No elements covering the images',
                'success'
            );
            return true;
        }
        
        // Apply quick fix
        function applyQuickFix() {
            clearResults();
            addResult(
                'üîß Applying Quick Fix',
                'Attempting to fix common issues...',
                'info'
            );
            
            const images = document.querySelectorAll('.cloth-image');
            const items = document.querySelectorAll('.cloth-item');
            
            let fixes = [];
            
            // Fix 1: Ensure images are visible
            images.forEach((img, i) => {
                img.style.display = 'block';
                img.style.visibility = 'visible';
                img.style.opacity = '1';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                fixes.push(`Image ${i}: Applied visibility fixes`);
            });
            
            // Fix 2: Ensure containers have size
            items.forEach((item, i) => {
                const rect = item.getBoundingClientRect();
                if (rect.height === 0) {
                    item.style.minHeight = '150px';
                    item.style.height = '150px';
                    fixes.push(`Item ${i}: Set minimum height`);
                }
                item.style.display = 'flex';
                item.style.overflow = 'visible';
            });
            
            addResult(
                '‚úÖ Quick Fix Applied',
                `Applied ${fixes.length} fixes. Check if images are now visible.`,
                'success',
                fixes.join('\n')
            );
            
            setTimeout(() => {
                addResult(
                    'üîÑ Re-running Tests',
                    'Checking if fix worked...',
                    'info'
                );
                setTimeout(runAllTests, 500);
            }, 1000);
        }
        
        // Run all tests
        function runAllTests() {
            clearResults();
            
            addResult(
                'üöÄ Starting Diagnostics',
                'Running comprehensive image visibility tests...',
                'info'
            );
            
            setTimeout(() => {
                const test1 = testImagesInDOM();
                if (!test1) return;
                
                setTimeout(() => {
                    const test2 = testImageLoadStatus();
                    
                    setTimeout(() => {
                        const test3 = testImageDimensions();
                        
                        setTimeout(() => {
                            const test4 = testParentContainer();
                            
                            setTimeout(() => {
                                const test5 = testCSSConflicts();
                                
                                setTimeout(() => {
                                    const test6 = testViewportVisibility();
                                    
                                    setTimeout(() => {
                                        const test7 = testOverlays();
                                        
                                        // Summary
                                        setTimeout(() => {
                                            if (!test3 || !test4) {
                                                addResult(
                                                    'üéØ Diagnosis Complete',
                                                    '<strong>ROOT CAUSE FOUND:</strong><br>' +
                                                    'Images are loading successfully but have ZERO DIMENSIONS or are HIDDEN by CSS.<br><br>' +
                                                    '<strong>Solution:</strong> Click "Apply Quick Fix" button above to fix CSS issues.',
                                                    'error'
                                                );
                                            } else {
                                                addResult(
                                                    '‚úÖ Diagnosis Complete',
                                                    'All tests passed! Images should be visible.',
                                                    'success'
                                                );
                                            }
                                        }, 300);
                                    }, 300);
                                }, 300);
                            }, 300);
                        }, 300);
                    }, 300);
                }, 300);
            }, 500);
        }
        
        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
